<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#7c3aed">
  <meta name="description" content="Find synonyms, antonyms, and definitions offline">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Synonyms">
  
  <title>Synonyms & Antonyms</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    .word-chip {
      display: inline-block;
      padding: 8px 16px;
      margin: 4px;
      background: #f3f4f6;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .word-chip:hover {
      background: #e5e7eb;
      transform: translateY(-2px);
    }
    .synonym-chip {
      background: #dbeafe;
      color: #1e40af;
    }
    .synonym-chip:hover {
      background: #bfdbfe;
    }
    .antonym-chip {
      background: #fee2e2;
      color: #991b1b;
    }
    .antonym-chip:hover {
      background: #fecaca;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- Load word database -->
  <script src="word-database.js"></script>
  
  <script>
    // App State
    let state = {
      searchTerm: '',
      currentWord: null,
      synonyms: [],
      antonyms: [],
      definition: '',
      loading: false,
      error: '',
      history: [],
      favorites: [],
      showHistory: false,
      showFavorites: false,
      isOnline: navigator.onLine
    };

    // Load saved data
    function loadData() {
      try {
        const savedHistory = localStorage.getItem('synonym-history');
        const savedFavorites = localStorage.getItem('synonym-favorites');
        
        if (savedHistory) {
          state.history = JSON.parse(savedHistory);
        }
        if (savedFavorites) {
          state.favorites = JSON.parse(savedFavorites);
        }
      } catch (error) {
        console.log('Error loading data:', error);
      }
    }

    // Save data
    function saveHistory() {
      try {
        if (state.history.length > 50) {
          state.history = state.history.slice(0, 50);
        }
        localStorage.setItem('synonym-history', JSON.stringify(state.history));
      } catch (error) {
        console.error('Error saving history:', error);
      }
    }

    function saveFavorites() {
      try {
        localStorage.setItem('synonym-favorites', JSON.stringify(state.favorites));
      } catch (error) {
        console.error('Error saving favorites:', error);
      }
    }

    // Add to history
    function addToHistory(word) {
      state.history = state.history.filter(w => w !== word);
      state.history.unshift(word);
      saveHistory();
    }

    // Toggle favorite
    function toggleFavorite(word) {
      if (state.favorites.includes(word)) {
        state.favorites = state.favorites.filter(w => w !== word);
      } else {
        state.favorites.push(word);
      }
      saveFavorites();
      render();
    }

    // Search from local database
    function searchLocal(word) {
      const normalized = word.toLowerCase().trim();
      return wordDatabase[normalized] || null;
    }

    // Get definition from API
    async function getDefinition(word) {
      if (!state.isOnline) return null;
      
      try {
        // Using Free Dictionary API
        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
        
        if (!response.ok) return null;
        
        const data = await response.json();
        if (data && data[0] && data[0].meanings && data[0].meanings[0]) {
          const meaning = data[0].meanings[0];
          const partOfSpeech = meaning.partOfSpeech || '';
          const definition = meaning.definitions[0]?.definition || '';
          
          if (definition) {
            return partOfSpeech ? `(${partOfSpeech}) ${definition}` : definition;
          }
        }
        return null;
      } catch (error) {
        console.error('Definition API error:', error);
        return null;
      }
    }

    // Search from API (when online)
    async function searchAPI(word) {
      if (!state.isOnline) return null;
      
      try {
        const synonymUrl = `https://api.datamuse.com/words?rel_syn=${encodeURIComponent(word)}&max=20`;
        const antonymUrl = `https://api.datamuse.com/words?rel_ant=${encodeURIComponent(word)}&max=20`;
        
        const [synResponse, antResponse] = await Promise.all([
          fetch(synonymUrl),
          fetch(antonymUrl)
        ]);
        
        const synonymData = await synResponse.json();
        const antonymData = await antResponse.json();
        
        if (synonymData.length === 0 && antonymData.length === 0) {
          return null;
        }
        
        return {
          synonyms: synonymData.map(item => item.word),
          antonyms: antonymData.map(item => item.word)
        };
      } catch (error) {
        console.error('API search error:', error);
        return null;
      }
    }

    // Main search function
    async function searchWord(word) {
      if (!word || !word.trim()) return;
      
      const normalized = word.toLowerCase().trim();
      state.searchTerm = word;
      state.currentWord = normalized;
      state.loading = true;
      state.error = '';
      state.synonyms = [];
      state.antonyms = [];
      state.definition = '';
      state.showHistory = false;
      state.showFavorites = false;
      render();
      
      addToHistory(normalized);
      
      // Try to get definition first (parallel with synonym search)
      const definitionPromise = getDefinition(normalized);
      
      // Try local database first
      const localResult = searchLocal(normalized);
      
      if (localResult) {
        state.synonyms = localResult.synonyms || [];
        state.antonyms = localResult.antonyms || [];
        
        // Wait for definition
        state.definition = await definitionPromise || '';
        
        state.loading = false;
        render();
        return;
      }
      
      // If not in local database and online, try API
      if (state.isOnline) {
        const apiResult = await searchAPI(normalized);
        
        if (apiResult) {
          state.synonyms = apiResult.synonyms || [];
          state.antonyms = apiResult.antonyms || [];
          
          // Wait for definition
          state.definition = await definitionPromise || '';
          
          state.loading = false;
          render();
        } else {
          state.error = 'Word not found. Try another word.';
          state.loading = false;
          render();
        }
      } else {
        state.error = 'Word not in offline database. Connect to internet for more words.';
        state.loading = false;
        render();
      }
    }

    // Clear search
    function clearSearch() {
      state.searchTerm = '';
      state.currentWord = null;
      state.synonyms = [];
      state.antonyms = [];
      state.definition = '';
      state.error = '';
      render();
    }

    // Delete history item
    function deleteHistoryItem(word) {
      state.history = state.history.filter(w => w !== word);
      saveHistory();
      render();
    }

    // Clear all history
    function clearHistory() {
      if (confirm('Clear all search history?')) {
        state.history = [];
        saveHistory();
        render();
      }
    }

    // SVG Icons
    function createIcon(name, size = 20) {
      const icons = {
        search: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>`,
        star: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
        starOutline: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
        history: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,
        x: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
        trash: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,
        wifi: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg>`,
        wifiOff: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"></path><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"></path><path d="M10.71 5.05A16 16 0 0 1 22.58 9"></path><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg>`
      };
      return icons[name] || '';
    }

    // Render function
    function render() {
      const root = document.getElementById('root');
      
      const isFavorite = state.currentWord && state.favorites.includes(state.currentWord);
      
      root.innerHTML = `
        <div class="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 p-3 sm:p-4">
          <div class="max-w-3xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-4 sm:mb-6 pt-4 sm:pt-6">
              <h1 class="text-2xl sm:text-3xl font-bold text-purple-900 mb-1">Synonyms & Antonyms</h1>
              <h2 class="text-lg sm:text-xl font-semibold text-purple-700 mb-2">Word Definitions</h2>
              <div class="flex items-center justify-center gap-2 text-xs">
                ${state.isOnline ? createIcon('wifi', 14) : createIcon('wifiOff', 14)}
                <span class="text-gray-600">${state.isOnline ? 'Online' : 'Offline'}</span>
              </div>
            </div>

            <!-- Search Box -->
            <div class="bg-white rounded-xl shadow-xl p-4 mb-4">
              <div class="flex gap-2">
                <input
                  type="text"
                  value="${state.searchTerm}"
                  oninput="state.searchTerm = this.value"
                  onkeypress="if(event.key === 'Enter') searchWord(state.searchTerm)"
                  placeholder="Enter a word..."
                  class="flex-1 px-4 py-3 border-2 border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-base"
                  autofocus
                >
                <button
                  onclick="searchWord(state.searchTerm)"
                  class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-lg transition-colors flex items-center justify-center"
                  style="min-width: 48px;"
                  title="Search"
                >
                  ${createIcon('search', 22)}
                </button>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-2 gap-3 mb-4">
              <button
                onclick="state.showHistory = !state.showHistory; state.showFavorites = false; render();"
                class="flex items-center justify-center gap-2 bg-white hover:bg-gray-50 text-gray-700 py-2.5 rounded-lg shadow transition-colors text-sm"
              >
                ${createIcon('history', 16)}
                History (${state.history.length})
              </button>
              <button
                onclick="state.showFavorites = !state.showFavorites; state.showHistory = false; render();"
                class="flex items-center justify-center gap-2 bg-white hover:bg-gray-50 text-gray-700 py-2.5 rounded-lg shadow transition-colors text-sm"
              >
                ${createIcon('star', 16)}
                Favorites (${state.favorites.length})
              </button>
            </div>

            <!-- Results -->
            ${state.loading ? `
              <div class="bg-white rounded-xl shadow-xl p-8 text-center">
                <div class="animate-spin inline-block w-8 h-8 border-4 border-purple-600 border-t-transparent rounded-full"></div>
                <p class="mt-4 text-gray-600">Searching...</p>
              </div>
            ` : state.error ? `
              <div class="bg-white rounded-xl shadow-xl p-8 text-center">
                <p class="text-red-600 mb-2">${state.error}</p>
                <button onclick="clearSearch()" class="text-purple-600 hover:text-purple-800 underline text-sm">
                  Try another word
                </button>
              </div>
            ` : state.currentWord ? `
              <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 mb-4">
                <!-- Word Header -->
                <div class="flex items-center justify-between mb-3">
                  <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 capitalize">${state.currentWord}</h2>
                  <button
                    onclick="toggleFavorite('${state.currentWord}')"
                    class="text-yellow-500 hover:text-yellow-600 transition-colors"
                    title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}"
                  >
                    ${isFavorite ? createIcon('star', 26) : createIcon('starOutline', 26)}
                  </button>
                </div>

                <!-- Definition -->
                ${state.definition ? `
                  <div class="mb-4 pb-4 border-b border-gray-200">
                    <h3 class="text-sm font-semibold text-gray-500 uppercase mb-2">Definition</h3>
                    <p class="text-gray-700 leading-relaxed">${state.definition}</p>
                  </div>
                ` : state.isOnline ? `
                  <div class="mb-4 pb-4 border-b border-gray-200">
                    <p class="text-sm text-gray-400 italic">No definition available</p>
                  </div>
                ` : ''}

                <!-- Synonyms -->
                ${state.synonyms.length > 0 ? `
                  <div class="mb-4">
                    <h3 class="text-base font-semibold text-blue-900 mb-2">
                      Synonyms (${state.synonyms.length})
                    </h3>
                    <div class="flex flex-wrap gap-2">
                      ${state.synonyms.map(word => `
                        <span
                          onclick="searchWord('${word}')"
                          class="word-chip synonym-chip"
                        >
                          ${word}
                        </span>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}

                <!-- Antonyms -->
                ${state.antonyms.length > 0 ? `
                  <div>
                    <h3 class="text-base font-semibold text-red-900 mb-2">
                      Antonyms (${state.antonyms.length})
                    </h3>
                    <div class="flex flex-wrap gap-2">
                      ${state.antonyms.map(word => `
                        <span
                          onclick="searchWord('${word}')"
                          class="word-chip antonym-chip"
                        >
                          ${word}
                        </span>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}

                ${state.synonyms.length === 0 && state.antonyms.length === 0 ? `
                  <p class="text-gray-500 text-center py-4">No synonyms or antonyms found</p>
                ` : ''}
              </div>
            ` : ''}

            <!-- History Panel -->
            ${state.showHistory && state.history.length > 0 ? `
              <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-base font-semibold text-gray-800">Recent Searches</h3>
                  <button
                    onclick="clearHistory()"
                    class="text-red-600 hover:text-red-700 text-xs flex items-center gap-1"
                  >
                    ${createIcon('trash', 14)}
                    Clear
                  </button>
                </div>
                <div class="space-y-2">
                  ${state.history.map(word => `
                    <div class="flex items-center justify-between p-2.5 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                      <button
                        onclick="searchWord('${word}')"
                        class="flex-1 text-left font-medium text-gray-700 capitalize text-sm"
                      >
                        ${word}
                      </button>
                      <button
                        onclick="deleteHistoryItem('${word}')"
                        class="text-gray-400 hover:text-red-600 transition-colors ml-2"
                      >
                        ${createIcon('x', 16)}
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : state.showHistory ? `
              <div class="bg-white rounded-xl shadow-xl p-8 text-center">
                <p class="text-gray-500">No search history yet</p>
              </div>
            ` : ''}

            <!-- Favorites Panel -->
            ${state.showFavorites && state.favorites.length > 0 ? `
              <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6">
                <h3 class="text-base font-semibold text-gray-800 mb-3">Favorite Words</h3>
                <div class="flex flex-wrap gap-2">
                  ${state.favorites.map(word => `
                    <div class="relative">
                      <button
                        onclick="searchWord('${word}')"
                        class="word-chip bg-yellow-100 text-yellow-900 hover:bg-yellow-200 pr-7"
                      >
                        ${word}
                      </button>
                      <button
                        onclick="toggleFavorite('${word}')"
                        class="absolute right-1 top-1/2 -translate-y-1/2 text-yellow-600 hover:text-red-600"
                      >
                        ${createIcon('x', 12)}
                      </button>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : state.showFavorites ? `
              <div class="bg-white rounded-xl shadow-xl p-8 text-center">
                <p class="text-gray-500">No favorites yet</p>
              </div>
            ` : ''}

            <!-- Info Box -->
            ${!state.currentWord && !state.showHistory && !state.showFavorites ? `
              <div class="bg-white rounded-xl shadow-xl p-5 sm:p-6 text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">How to Use</h3>
                <div class="text-left space-y-2 text-sm text-gray-600 max-w-md mx-auto">
                  <p>üîç <strong>Search:</strong> Type a word and tap the search icon</p>
                  <p>üìñ <strong>Definition:</strong> Meaning shown at the top</p>
                  <p>üîµ <strong>Synonyms:</strong> Similar words (blue chips)</p>
                  <p>üî¥ <strong>Antonyms:</strong> Opposite words (red chips)</p>
                  <p>‚≠ê <strong>Favorites:</strong> Save words you use often</p>
                  <p>üïê <strong>History:</strong> View recent searches</p>
                  <p>üì° <strong>${state.isOnline ? 'Online' : 'Offline'}:</strong> ${state.isOnline ? 'Full access to all features' : '100+ common words available'}</p>
                </div>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    // Monitor online/offline status
    window.addEventListener('online', () => {
      state.isOnline = true;
      render();
    });

    window.addEventListener('offline', () => {
      state.isOnline = false;
      render();
    });

    // Initialize
    loadData();
    render();
  </script>
</body>
</html>
